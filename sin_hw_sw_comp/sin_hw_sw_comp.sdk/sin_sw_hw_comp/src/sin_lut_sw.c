/*
 * sin_lut_sw.c
 *
 *  Created on: 8 abr. 2021
 *      Author: ferna
 */

#include <stdint.h>
#include <stdlib.h>                // For pointers
#include "sin_lut_sw.h"
#include <math.h>

uint32_t sin_lut[200] = {2147483648, 2214937739, 2282325261, 2349579711, 2416634717, 2483424103, 2549881956, 2615942691, 2681541113, 2746612486, 2811092590, 2874917792, 2938025105, 3000352248, 3061837714, 3122420822, 3182041785, 3240641764, 3298162928, 3354548510, 3409742865, 3463691523, 3516341242, 3567640064, 3617537363, 3665983897, 3712931854, 3758334903, 3802148237, 3844328616, 3884834413, 3923625656, 3960664061, 3995913075, 4029337913, 4060905588, 4090584946, 4118346699, 4144163447, 4168009713, 4189861964, 4209698634, 4227500147, 4243248935, 4256929456, 4268528208, 4278033745, 4285436687, 4290729727, 4293907641, 4294967295, 4293907641, 4290729727, 4285436687, 4278033745, 4268528208, 4256929456, 4243248935, 4227500147, 4209698634, 4189861964, 4168009713, 4144163447, 4118346699, 4090584946, 4060905588, 4029337913, 3995913075, 3960664061, 3923625656, 3884834413, 3844328616, 3802148237, 3758334903, 3712931854, 3665983897, 3617537363, 3567640064, 3516341242, 3463691523, 3409742865, 3354548510, 3298162928, 3240641764, 3182041785, 3122420822, 3061837714, 3000352248, 2938025105, 2874917792, 2811092590, 2746612486, 2681541113, 2615942691, 2549881956, 2483424103, 2416634717, 2349579711, 2282325261, 2214937739, 2147483648, 2080029556, 2012642034, 1945387584, 1878332578, 1811543192, 1745085339, 1679024604, 1613426182, 1548354809, 1483874705, 1420049503, 1356942190, 1294615047, 1233129581, 1172546473, 1112925510, 1054325531, 996804367, 940418785, 885224430, 831275772, 778626053, 727327231, 677429932, 628983398, 582035441, 536632392, 492819058, 450638679, 410132882, 371341639, 334303234, 299054220, 265629382, 234061707, 204382349, 176620596, 150803848, 126957582, 105105331, 85268661, 67467148, 51718360, 38037839, 26439087, 16933550, 9530608, 4237568, 1059654, 0, 1059654, 4237568, 9530608, 16933550, 26439087, 38037839, 51718360, 67467148, 85268661, 105105331, 126957582, 150803848, 176620596, 204382349, 234061707, 265629382, 299054220, 334303234, 371341639, 410132882, 450638679, 492819058, 536632392, 582035441, 628983398, 677429932, 727327231, 778626053, 831275772, 885224430, 940418785, 996804367, 1054325531, 1112925510, 1172546473, 1233129581, 1294615047, 1356942190, 1420049503, 1483874705, 1548354809, 1613426182, 1679024604, 1745085339, 1811543192, 1878332578, 1945387584, 2012642034, 2080029556};

uint32_t *sin_from_lut(float time)
{
	uint32_t *vref = (uint32_t *)malloc(5 * sizeof(uint32_t));

	uint32_t index0 = (uint32_t) round((time - floor(time / (PERIOD_NUMBER_SAMPLES * SAMPLE_PERIOD)) * PERIOD_NUMBER_SAMPLES * SAMPLE_PERIOD) / SAMPLE_PERIOD);
	uint32_t index1 = (index0 + 40) ? (index0 + 40) : (index0 - 160);
	uint32_t index2 = (index1 + 40) ? (index1 + 40) : (index1 - 160);
	uint32_t index3 = (index2 + 40) ? (index2 + 40) : (index2 - 160);
	uint32_t index4 = (index3 + 40) ? (index3 + 40) : (index3 - 160);

	vref[0] = sin_lut[index0];
	vref[1] = sin_lut[index1];
	vref[2] = sin_lut[index2];
	vref[3] = sin_lut[index3];
	vref[4] = sin_lut[index4];

	return vref;
}
